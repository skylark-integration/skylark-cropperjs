/**
 * skylark-cropperjs - A version of cropperjs that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-cropperjs/
 * @license MIT
 */
!function(t,e){var i=e.define,require=e.require,a="function"==typeof i&&i.amd,s=!a&&"undefined"!=typeof exports;if(!a&&!i){var n={};i=e.define=function(t,e,i){"function"==typeof i?(n[t]={factory:i,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var i=e.split("/"),a=t.split("/");i.pop();for(var s=0;s<a.length;s++)"."!=a[s]&&(".."==a[s]?i.pop():i.push(a[s]));return i.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):n[t]={factory:null,resolved:!0,exports:i}},require=e.require=function(t){if(!n.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=n[t];if(!module.resolved){var i=[];module.deps.forEach(function(t){i.push(require(t))}),module.exports=module.factory.apply(e,i)||null,module.resolved=!0}return module.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-langx-ns/_attach",[],function(){return function(t,e,i){"string"==typeof e&&(e=e.split("."));for(var a=e.length,s=t,n=0,r=e[n++];n<a;)s=s[r]=s[r]||{},r=e[n++];return s[r]=i}}),t("skylark-langx-ns/ns",["./_attach"],function(t){var e={attach:function(i,a){return t(e,i,a)}};return e}),t("skylark-langx-ns/main",["./ns"],function(t){return t}),t("skylark-langx-ns",["skylark-langx-ns/main"],function(t){return t}),t("skylark-langx/skylark",["skylark-langx-ns"],function(t){return t}),t("skylark-cropperjs/constants",[],function(){"use strict";const t="undefined"!=typeof window&&void 0!==window.document,e=t?window:{},i=!!t&&"ontouchstart"in e.document.documentElement,a=!!t&&"PointerEvent"in e,s="cropper-crop",n="cropper-disabled",r="cropper-hidden",o="cropper-hide",h="cropper-invisible",c="cropper-modal",d="cropper-move",l="cropperAction",p="cropperPreview",m=i?"touchstart":"mousedown",g=i?"touchmove":"mousemove",u=i?"touchend touchcancel":"mouseup",f=a?"pointerdown":m,E=a?"pointermove":g,C=a?"pointerup pointercancel":u;return{IS_BROWSER:t,WINDOW:e,IS_TOUCH_DEVICE:i,HAS_POINTER_EVENT:a,NAMESPACE:"cropper",ACTION_ALL:"all",ACTION_CROP:"crop",ACTION_MOVE:"move",ACTION_ZOOM:"zoom",ACTION_EAST:"e",ACTION_WEST:"w",ACTION_SOUTH:"s",ACTION_NORTH:"n",ACTION_NORTH_EAST:"ne",ACTION_NORTH_WEST:"nw",ACTION_SOUTH_EAST:"se",ACTION_SOUTH_WEST:"sw",CLASS_CROP:s,CLASS_DISABLED:n,CLASS_HIDDEN:r,CLASS_HIDE:o,CLASS_INVISIBLE:h,CLASS_MODAL:c,CLASS_MOVE:d,DATA_ACTION:l,DATA_PREVIEW:p,DRAG_MODE_CROP:"crop",DRAG_MODE_MOVE:"move",DRAG_MODE_NONE:"none",EVENT_CROP:"crop",EVENT_CROP_END:"cropend",EVENT_CROP_MOVE:"cropmove",EVENT_CROP_START:"cropstart",EVENT_DBLCLICK:"dblclick",EVENT_TOUCH_START:m,EVENT_TOUCH_MOVE:g,EVENT_TOUCH_END:u,EVENT_POINTER_DOWN:f,EVENT_POINTER_MOVE:E,EVENT_POINTER_UP:C,EVENT_READY:"ready",EVENT_RESIZE:"resize",EVENT_WHEEL:"wheel",EVENT_ZOOM:"zoom",MIME_TYPE_JPEG:"image/jpeg",REGEXP_ACTIONS:/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,REGEXP_DATA_URL:/^data:/,REGEXP_DATA_URL_JPEG:/^data:image\/jpeg;base64,/,REGEXP_TAG_NAME:/^img|canvas$/i,MIN_CONTAINER_WIDTH:200,MIN_CONTAINER_HEIGHT:100}}),t("skylark-cropperjs/defaults",["./constants"],function(t){"use strict";return{viewMode:0,dragMode:t.DRAG_MODE_CROP,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null}}),t("skylark-cropperjs/template",[],function(){"use strict";return'<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>'}),t("skylark-cropperjs/utilities",["./constants"],function(t){"use strict";var e=Number.isNaN||WINDOW.isNaN;function i(t){return"number"==typeof t&&!e(t)}var a=function(t){return t>0&&t<1/0};function s(t){return"object"===_typeof(t)&&null!==t}var n=Object.prototype.hasOwnProperty;function r(t){return"function"==typeof t}var o=Array.prototype.slice;function h(t){return Array.from?Array.from(t):o.call(t)}function c(t,e){return t&&r(e)&&(Array.isArray(t)||i(t.length)?h(t).forEach(function(i,a){e.call(t,i,a,t)}):s(t)&&Object.keys(t).forEach(function(i){e.call(t,t[i],i,t)})),t}var d=Object.assign||function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),a=1;a<e;a++)i[a-1]=arguments[a];return s(t)&&i.length>0&&i.forEach(function(e){s(e)&&Object.keys(e).forEach(function(i){t[i]=e[i]})}),t},l=/\.\d*(?:0|9){12}\d*$/;function p(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return l.test(t)?Math.round(t*e)/e:t}var m=/^width|height|left|top|marginLeft|marginTop$/;function g(t,e){if(e)if(i(t.length))c(t,function(t){g(t,e)});else if(t.classList)t.classList.add(e);else{var a=t.className.trim();a?a.indexOf(e)<0&&(t.className="".concat(a," ").concat(e)):t.className=e}}function u(t,e){e&&(i(t.length)?c(t,function(t){u(t,e)}):t.classList?t.classList.remove(e):t.className.indexOf(e)>=0&&(t.className=t.className.replace(e,"")))}var f=/([a-z\d])([A-Z])/g;function E(t){return t.replace(f,"$1-$2").toLowerCase()}var C=/\s\s*/,T=function(){var t=!1;if(IS_BROWSER){var e=!1,i=function(){},a=Object.defineProperty({},"once",{get:function(){return t=!0,e},set:function(t){e=t}});WINDOW.addEventListener("test",i,a),WINDOW.removeEventListener("test",i,a)}return t}();var N=WINDOW.location,v=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function O(t){var e=t.aspectRatio,i=t.height,s=t.width,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",r=a(s),o=a(i);if(r&&o){var h=i*e;"contain"===n&&h>s||"cover"===n&&h<s?i=s/e:s=i*e}else r?i=s/e:o&&(s=i*e);return{width:s,height:i}}var A=String.fromCharCode;function _(t,e,i){var a="";i+=e;for(var s=e;s<i;s+=1)a+=A(t.getUint8(s));return a}var w=/^data:.*,/;return{isNaN:e,isNumber:i,isPositiveNumber:a,isUndefined:function(t){return void 0===t},isObject:s,isPlainObject:function(t){if(!s(t))return!1;try{var e=t.constructor,i=e.prototype;return e&&i&&n.call(i,"isPrototypeOf")}catch(t){return!1}},isFunction:r,toArray:h,forEach:c,assign:d,normalizeDecimalNumber:p,setStyle:function(t,e){var a=t.style;c(e,function(t,e){m.test(e)&&i(t)&&(t="".concat(t,"px")),a[e]=t})},hasClass:function(t,e){return t.classList?t.classList.contains(e):t.className.indexOf(e)>-1},addClass:g,removeClass:u,toggleClass:function t(e,a,s){if(!a)return;if(i(e.length))return void c(e,function(e){t(e,a,s)});s?g(e,a):u(e,a)},toParamCase:E,getData:function(t,e){if(s(t[e]))return t[e];if(t.dataset)return t.dataset[e];return t.getAttribute("data-".concat(E(e)))},setData:function(t,e,i){s(i)?t[e]=i:t.dataset?t.dataset[e]=i:t.setAttribute("data-".concat(E(e)),i)},removeData:function(t,e){if(s(t[e]))try{delete t[e]}catch(i){t[e]=void 0}else if(t.dataset)try{delete t.dataset[e]}catch(i){t.dataset[e]=void 0}else t.removeAttribute("data-".concat(E(e)))},removeListener:function(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=i;e.trim().split(C).forEach(function(e){if(!T){var n=t.listeners;n&&n[e]&&n[e][i]&&(s=n[e][i],delete n[e][i],0===Object.keys(n[e]).length&&delete n[e],0===Object.keys(n).length&&delete t.listeners)}t.removeEventListener(e,s,a)})},addListener:function(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=i;e.trim().split(C).forEach(function(e){if(a.once&&!T){var n=t.listeners,r=void 0===n?{}:n;s=function(){delete r[e][i],t.removeEventListener(e,s,a);for(var n=arguments.length,o=new Array(n),h=0;h<n;h++)o[h]=arguments[h];i.apply(t,o)},r[e]||(r[e]={}),r[e][i]&&t.removeEventListener(e,r[e][i],a),r[e][i]=s,t.listeners=r}t.addEventListener(e,s,a)})},dispatchEvent:function(t,e,i){var a;r(Event)&&r(CustomEvent)?a=new CustomEvent(e,{detail:i,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,i);return t.dispatchEvent(a)},getOffset:function(t){var e=t.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}},isCrossOriginURL:function(t){var e=t.match(v);return null!==e&&(e[1]!==N.protocol||e[2]!==N.hostname||e[3]!==N.port)},addTimestamp:function(t){var e="timestamp=".concat((new Date).getTime());return t+(-1===t.indexOf("?")?"?":"&")+e},getTransforms:function(t){var e=t.rotate,a=t.scaleX,s=t.scaleY,n=t.translateX,r=t.translateY,o=[];i(n)&&0!==n&&o.push("translateX(".concat(n,"px)"));i(r)&&0!==r&&o.push("translateY(".concat(r,"px)"));i(e)&&0!==e&&o.push("rotate(".concat(e,"deg)"));i(a)&&1!==a&&o.push("scaleX(".concat(a,")"));i(s)&&1!==s&&o.push("scaleY(".concat(s,")"));var h=o.length?o.join(" "):"none";return{WebkitTransform:h,msTransform:h,transform:h}},getMaxZoomRatio:function(t){var e=_objectSpread2({},t),i=[];return c(t,function(t,a){delete e[a],c(e,function(e){var a=Math.abs(t.startX-e.startX),s=Math.abs(t.startY-e.startY),n=Math.abs(t.endX-e.endX),r=Math.abs(t.endY-e.endY),o=Math.sqrt(a*a+s*s),h=(Math.sqrt(n*n+r*r)-o)/o;i.push(h)})}),i.sort(function(t,e){return Math.abs(t)<Math.abs(e)}),i[0]},getPointer:function(t,e){var i=t.pageX,a=t.pageY,s={endX:i,endY:a};return e?s:_objectSpread2({startX:i,startY:a},s)},getPointersCenter:function(t){var e=0,i=0,a=0;return c(t,function(t){var s=t.startX,n=t.startY;e+=s,i+=n,a+=1}),{pageX:e/=a,pageY:i/=a}},getAdjustedSizes:O,getRotatedSizes:function(t){var e=t.width,i=t.height,a=t.degree;if(90==(a=Math.abs(a)%180))return{width:i,height:e};var s=a%90*Math.PI/180,n=Math.sin(s),r=Math.cos(s),o=e*r+i*n,h=e*n+i*r;return a>90?{width:h,height:o}:{width:o,height:h}},getSourceCanvas:function(t,e,i,a){var s=e.aspectRatio,n=e.naturalWidth,r=e.naturalHeight,o=e.rotate,h=void 0===o?0:o,c=e.scaleX,d=void 0===c?1:c,l=e.scaleY,m=void 0===l?1:l,g=i.aspectRatio,u=i.naturalWidth,f=i.naturalHeight,E=a.fillColor,C=void 0===E?"transparent":E,T=a.imageSmoothingEnabled,N=void 0===T||T,v=a.imageSmoothingQuality,A=void 0===v?"low":v,_=a.maxWidth,w=void 0===_?1/0:_,b=a.maxHeight,x=void 0===b?1/0:b,D=a.minWidth,S=void 0===D?0:D,y=a.minHeight,M=void 0===y?0:y,I=document.createElement("canvas"),R=I.getContext("2d"),L=O({aspectRatio:g,width:w,height:x}),H=O({aspectRatio:g,width:S,height:M},"cover"),k=Math.min(L.width,Math.max(H.width,u)),P=Math.min(L.height,Math.max(H.height,f)),W=O({aspectRatio:s,width:w,height:x}),B=O({aspectRatio:s,width:S,height:M},"cover"),V=Math.min(W.width,Math.max(B.width,n)),U=Math.min(W.height,Math.max(B.height,r)),z=[-V/2,-U/2,V,U];return I.width=p(k),I.height=p(P),R.fillStyle=C,R.fillRect(0,0,k,P),R.save(),R.translate(k/2,P/2),R.rotate(h*Math.PI/180),R.scale(d,m),R.imageSmoothingEnabled=N,R.imageSmoothingQuality=A,R.drawImage.apply(R,[t].concat(_toConsumableArray(z.map(function(t){return Math.floor(p(t))})))),R.restore(),I},getStringFromCharCode:_,dataURLToArrayBuffer:function(t){var e=t.replace(w,""),i=atob(e),a=new ArrayBuffer(i.length),s=new Uint8Array(a);return c(s,function(t,e){s[e]=i.charCodeAt(e)}),a},arrayBufferToDataURL:function(t,e){var i=[],a=new Uint8Array(t);for(;a.length>0;)i.push(A.apply(null,h(a.subarray(0,8192)))),a=a.subarray(8192);return"data:".concat(e,";base64,").concat(btoa(i.join("")))},resetAndGetOrientation:function(t){var e,i=new DataView(t);try{var a,s,n;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var r=i.byteLength,o=2;o+1<r;){if(255===i.getUint8(o)&&225===i.getUint8(o+1)){s=o;break}o+=1}if(s){var h=s+4,c=s+10;if("Exif"===_(i,h,4)){var d=i.getUint16(c);if(((a=18761===d)||19789===d)&&42===i.getUint16(c+2,a)){var l=i.getUint32(c+4,a);l>=8&&(n=c+l)}}}if(n){var p,m,g=i.getUint16(n,a);for(m=0;m<g;m+=1)if(p=n+12*m+2,274===i.getUint16(p,a)){p+=8,e=i.getUint16(p,a),i.setUint16(p,1,a);break}}}catch(t){e=1}return e},parseOrientation:function(t){var e=0,i=1,a=1;switch(t){case 2:i=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,i=-1;break;case 8:e=-90}return{rotate:e,scaleX:i,scaleY:a}}}}),t("skylark-cropperjs/render",["./constants","./utilities"],function(t,e){"use strict";return{render(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer(){const{element:i,options:a,container:s,cropper:n}=this;e.addClass(n,t.CLASS_HIDDEN),e.removeClass(i,t.CLASS_HIDDEN);const r={width:Math.max(s.offsetWidth,Number(a.minContainerWidth)||200),height:Math.max(s.offsetHeight,Number(a.minContainerHeight)||100)};this.containerData=r,e.setStyle(n,{width:r.width,height:r.height}),e.addClass(i,t.CLASS_HIDDEN),e.removeClass(n,t.CLASS_HIDDEN)},initCanvas(){const{containerData:t,imageData:i}=this,{viewMode:a}=this.options,s=Math.abs(i.rotate)%180==90,n=s?i.naturalHeight:i.naturalWidth,r=s?i.naturalWidth:i.naturalHeight,o=n/r;let h=t.width,c=t.height;t.height*o>t.width?3===a?h=t.height*o:c=t.width/o:3===a?c=t.width/o:h=t.height*o;const d={aspectRatio:o,naturalWidth:n,naturalHeight:r,width:h,height:c};d.left=(t.width-h)/2,d.top=(t.height-c)/2,d.oldLeft=d.left,d.oldTop=d.top,this.canvasData=d,this.limited=1===a||2===a,this.limitCanvas(!0,!0),this.initialImageData=e.assign({},i),this.initialCanvasData=e.assign({},d)},limitCanvas(t,i){const{options:a,containerData:s,canvasData:n,cropBoxData:r}=this,{viewMode:o}=a,{aspectRatio:h}=n,c=this.cropped&&r;if(t){let t=Number(a.minCanvasWidth)||0,i=Number(a.minCanvasHeight)||0;o>1?(t=Math.max(t,s.width),i=Math.max(i,s.height),3===o&&(i*h>t?t=i*h:i=t/h)):o>0&&(t?t=Math.max(t,c?r.width:0):i?i=Math.max(i,c?r.height:0):c&&(t=r.width,(i=r.height)*h>t?t=i*h:i=t/h)),({width:t,height:i}=e.getAdjustedSizes({aspectRatio:h,width:t,height:i})),n.minWidth=t,n.minHeight=i,n.maxWidth=1/0,n.maxHeight=1/0}if(i)if(o>(c?0:1)){const t=s.width-n.width,e=s.height-n.height;n.minLeft=Math.min(0,t),n.minTop=Math.min(0,e),n.maxLeft=Math.max(0,t),n.maxTop=Math.max(0,e),c&&this.limited&&(n.minLeft=Math.min(r.left,r.left+(r.width-n.width)),n.minTop=Math.min(r.top,r.top+(r.height-n.height)),n.maxLeft=r.left,n.maxTop=r.top,2===o&&(n.width>=s.width&&(n.minLeft=Math.min(0,t),n.maxLeft=Math.max(0,t)),n.height>=s.height&&(n.minTop=Math.min(0,e),n.maxTop=Math.max(0,e))))}else n.minLeft=-n.width,n.minTop=-n.height,n.maxLeft=s.width,n.maxTop=s.height},renderCanvas(t,i){const{canvasData:a,imageData:s}=this;if(i){const{width:t,height:i}=e.getRotatedSizes({width:s.naturalWidth*Math.abs(s.scaleX||1),height:s.naturalHeight*Math.abs(s.scaleY||1),degree:s.rotate||0}),n=a.width*(t/a.naturalWidth),r=a.height*(i/a.naturalHeight);a.left-=(n-a.width)/2,a.top-=(r-a.height)/2,a.width=n,a.height=r,a.aspectRatio=t/i,a.naturalWidth=t,a.naturalHeight=i,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,e.setStyle(this.canvas,e.assign({width:a.width,height:a.height},e.getTransforms({translateX:a.left,translateY:a.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage(t){const{canvasData:i,imageData:a}=this,s=a.naturalWidth*(i.width/i.naturalWidth),n=a.naturalHeight*(i.height/i.naturalHeight);e.assign(a,{width:s,height:n,left:(i.width-s)/2,top:(i.height-n)/2}),e.setStyle(this.image,e.assign({width:a.width,height:a.height},e.getTransforms(e.assign({translateX:a.left,translateY:a.top},a)))),t&&this.output()},initCropBox(){const{options:t,canvasData:i}=this,a=t.aspectRatio||t.initialAspectRatio,s=Number(t.autoCropArea)||.8,n={width:i.width,height:i.height};a&&(i.height*a>i.width?n.height=n.width/a:n.width=n.height*a),this.cropBoxData=n,this.limitCropBox(!0,!0),n.width=Math.min(Math.max(n.width,n.minWidth),n.maxWidth),n.height=Math.min(Math.max(n.height,n.minHeight),n.maxHeight),n.width=Math.max(n.minWidth,n.width*s),n.height=Math.max(n.minHeight,n.height*s),n.left=i.left+(i.width-n.width)/2,n.top=i.top+(i.height-n.height)/2,n.oldLeft=n.left,n.oldTop=n.top,this.initialCropBoxData=e.assign({},n)},limitCropBox(t,e){const{options:i,containerData:a,canvasData:s,cropBoxData:n,limited:r}=this,{aspectRatio:o}=i;if(t){let t=Number(i.minCropBoxWidth)||0,e=Number(i.minCropBoxHeight)||0,h=r?Math.min(a.width,s.width,s.width+s.left,a.width-s.left):a.width,c=r?Math.min(a.height,s.height,s.height+s.top,a.height-s.top):a.height;t=Math.min(t,a.width),e=Math.min(e,a.height),o&&(t&&e?e*o>t?e=t/o:t=e*o:t?e=t/o:e&&(t=e*o),c*o>h?c=h/o:h=c*o),n.minWidth=Math.min(t,h),n.minHeight=Math.min(e,c),n.maxWidth=h,n.maxHeight=c}e&&(r?(n.minLeft=Math.max(0,s.left),n.minTop=Math.max(0,s.top),n.maxLeft=Math.min(a.width,s.left+s.width)-n.width,n.maxTop=Math.min(a.height,s.top+s.height)-n.height):(n.minLeft=0,n.minTop=0,n.maxLeft=a.width-n.width,n.maxTop=a.height-n.height))},renderCropBox(){const{options:i,containerData:a,cropBoxData:s}=this;(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=Math.min(Math.max(s.width,s.minWidth),s.maxWidth),s.height=Math.min(Math.max(s.height,s.minHeight),s.maxHeight),this.limitCropBox(!1,!0),s.left=Math.min(Math.max(s.left,s.minLeft),s.maxLeft),s.top=Math.min(Math.max(s.top,s.minTop),s.maxTop),s.oldLeft=s.left,s.oldTop=s.top,i.movable&&i.cropBoxMovable&&e.setData(this.face,t.DATA_ACTION,s.width>=a.width&&s.height>=a.height?t.ACTION_MOVE:t.ACTION_ALL),e.setStyle(this.cropBox,e.assign({width:s.width,height:s.height},e.getTransforms({translateX:s.left,translateY:s.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output(){this.preview(),e.dispatchEvent(this.element,t.EVENT_CROP,this.getData())}}}),t("skylark-cropperjs/preview",["./constants","./utilities"],function(t,e){"use strict";return{initPreview(){const{element:i,crossOrigin:a}=this,{preview:s}=this.options,n=a?this.crossOriginUrl:this.url,r=i.alt||"The image to preview",o=document.createElement("img");if(a&&(o.crossOrigin=a),o.src=n,o.alt=r,this.viewBox.appendChild(o),this.viewBoxImage=o,!s)return;let h=s;"string"==typeof s?h=i.ownerDocument.querySelectorAll(s):s.querySelector&&(h=[s]),this.previews=h,e.forEach(h,i=>{const s=document.createElement("img");e.setData(i,t.DATA_PREVIEW,{width:i.offsetWidth,height:i.offsetHeight,html:i.innerHTML}),a&&(s.crossOrigin=a),s.src=n,s.alt=r,s.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',i.innerHTML="",i.appendChild(s)})},resetPreview(){e.forEach(this.previews,i=>{const a=e.getData(i,t.DATA_PREVIEW);e.setStyle(i,{width:a.width,height:a.height}),i.innerHTML=a.html,e.removeData(i,t.DATA_PREVIEW)})},preview(){const{imageData:i,canvasData:a,cropBoxData:s}=this,{width:n,height:r}=s,{width:o,height:h}=i,c=s.left-a.left-i.left,d=s.top-a.top-i.top;this.cropped&&!this.disabled&&(e.setStyle(this.viewBoxImage,e.assign({width:o,height:h},e.getTransforms(e.assign({translateX:-c,translateY:-d},i)))),e.forEach(this.previews,a=>{const s=e.getData(a,t.DATA_PREVIEW),l=s.width,p=s.height;let m=l,g=p,u=1;n&&(g=r*(u=l/n)),r&&g>p&&(m=n*(u=p/r),g=p),e.setStyle(a,{width:m,height:g}),e.setStyle(a.getElementsByTagName("img")[0],e.assign({width:o*u,height:h*u},e.getTransforms(e.assign({translateX:-c*u,translateY:-d*u},i))))}))}}}),t("skylark-cropperjs/events",["./constants","./utilities"],function(t,e){"use strict";return{bind(){const{element:i,options:a,cropper:s}=this;e.isFunction(a.cropstart)&&e.addListener(i,t.EVENT_CROP_START,a.cropstart),e.isFunction(a.cropmove)&&e.addListener(i,t.EVENT_CROP_MOVE,a.cropmove),e.isFunction(a.cropend)&&e.addListener(i,t.EVENT_CROP_END,a.cropend),e.isFunction(a.crop)&&e.addListener(i,t.EVENT_CROP,a.crop),e.isFunction(a.zoom)&&e.addListener(i,t.EVENT_ZOOM,a.zoom),e.addListener(s,t.EVENT_POINTER_DOWN,this.onCropStart=this.cropStart.bind(this)),a.zoomable&&a.zoomOnWheel&&e.addListener(s,t.EVENT_WHEEL,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&e.addListener(s,t.EVENT_DBLCLICK,this.onDblclick=this.dblclick.bind(this)),e.addListener(i.ownerDocument,t.EVENT_POINTER_MOVE,this.onCropMove=this.cropMove.bind(this)),e.addListener(i.ownerDocument,t.EVENT_POINTER_UP,this.onCropEnd=this.cropEnd.bind(this)),a.responsive&&e.addListener(window,t.EVENT_RESIZE,this.onResize=this.resize.bind(this))},unbind(){const{element:i,options:a,cropper:s}=this;e.isFunction(a.cropstart)&&e.removeListener(i,t.EVENT_CROP_START,a.cropstart),e.isFunction(a.cropmove)&&e.removeListener(i,t.EVENT_CROP_MOVE,a.cropmove),e.isFunction(a.cropend)&&e.removeListener(i,t.EVENT_CROP_END,a.cropend),e.isFunction(a.crop)&&e.removeListener(i,t.EVENT_CROP,a.crop),e.isFunction(a.zoom)&&e.removeListener(i,t.EVENT_ZOOM,a.zoom),e.removeListener(s,t.EVENT_POINTER_DOWN,this.onCropStart),a.zoomable&&a.zoomOnWheel&&e.removeListener(s,t.EVENT_WHEEL,this.onWheel,{passive:!1,capture:!0}),a.toggleDragModeOnDblclick&&e.removeListener(s,t.EVENT_DBLCLICK,this.onDblclick),e.removeListener(i.ownerDocument,t.EVENT_POINTER_MOVE,this.onCropMove),e.removeListener(i.ownerDocument,t.EVENT_POINTER_UP,this.onCropEnd),a.responsive&&e.removeListener(window,t.EVENT_RESIZE,this.onResize)}}}),t("skylark-cropperjs/handlers",["./constants","./utilities"],function(t,e){"use strict";return{resize(){const{options:i,container:a,containerData:s}=this,n=Number(i.minContainerWidth)||t.MIN_CONTAINER_WIDTH,r=Number(i.minContainerHeight)||t.MIN_CONTAINER_HEIGHT;if(this.disabled||s.width<=n||s.height<=r)return;const o=a.offsetWidth/s.width;if(1!==o||a.offsetHeight!==s.height){let t,a;i.restore&&(t=this.getCanvasData(),a=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(e.forEach(t,(e,i)=>{t[i]=e*o})),this.setCropBoxData(e.forEach(a,(t,e)=>{a[e]=t*o})))}},dblclick(){this.disabled||this.options.dragMode===t.DRAG_MODE_NONE||this.setDragMode(e.hasClass(this.dragBox,t.CLASS_CROP)?t.DRAG_MODE_MOVE:t.DRAG_MODE_CROP)},wheel(t){const e=Number(this.options.wheelZoomRatio)||.1;let i=1;this.disabled||(t.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(()=>{this.wheeling=!1},50),t.deltaY?i=t.deltaY>0?1:-1:t.wheelDelta?i=-t.wheelDelta/120:t.detail&&(i=t.detail>0?1:-1),this.zoom(-i*e,t)))},cropStart(i){const{buttons:a,button:s}=i;if(this.disabled||("mousedown"===i.type||"pointerdown"===i.type&&"mouse"===i.pointerType)&&(e.isNumber(a)&&1!==a||e.isNumber(s)&&0!==s||i.ctrlKey))return;const{options:n,pointers:r}=this;let o;i.changedTouches?e.forEach(i.changedTouches,t=>{r[t.identifier]=e.getPointer(t)}):r[i.pointerId||0]=e.getPointer(i),o=Object.keys(r).length>1&&n.zoomable&&n.zoomOnTouch?t.ACTION_ZOOM:e.getData(i.target,t.DATA_ACTION),t.REGEXP_ACTIONS.test(o)&&!1!==e.dispatchEvent(this.element,t.EVENT_CROP_START,{originalEvent:i,action:o})&&(i.preventDefault(),this.action=o,this.cropping=!1,o===t.ACTION_CROP&&(this.cropping=!0,e.addClass(this.dragBox,t.CLASS_MODAL)))},cropMove(i){const{action:a}=this;if(this.disabled||!a)return;const{pointers:s}=this;i.preventDefault(),!1!==e.dispatchEvent(this.element,t.EVENT_CROP_MOVE,{originalEvent:i,action:a})&&(i.changedTouches?e.forEach(i.changedTouches,t=>{e.assign(s[t.identifier]||{},e.getPointer(t,!0))}):e.assign(s[i.pointerId||0]||{},e.getPointer(i,!0)),this.change(i))},cropEnd(i){if(this.disabled)return;const{action:a,pointers:s}=this;i.changedTouches?e.forEach(i.changedTouches,t=>{delete s[t.identifier]}):delete s[i.pointerId||0],a&&(i.preventDefault(),Object.keys(s).length||(this.action=""),this.cropping&&(this.cropping=!1,e.toggleClass(this.dragBox,t.CLASS_MODAL,this.cropped&&this.options.modal)),e.dispatchEvent(this.element,t.EVENT_CROP_END,{originalEvent:i,action:a}))}}}),t("skylark-cropperjs/change",["./constants","./utilities"],function(t,e){"use strict";return{change(i){const{options:a,canvasData:s,containerData:n,cropBoxData:r,pointers:o}=this;let{action:h}=this,{aspectRatio:c}=a,{left:d,top:l,width:p,height:m}=r;const g=d+p,u=l+m;let f,E=0,C=0,T=n.width,N=n.height,v=!0;!c&&i.shiftKey&&(c=p&&m?p/m:1),this.limited&&(({minLeft:E,minTop:C}=r),T=E+Math.min(n.width,s.width,s.left+s.width),N=C+Math.min(n.height,s.height,s.top+s.height));const O=o[Object.keys(o)[0]],A={x:O.endX-O.startX,y:O.endY-O.startY},_=e=>{switch(e){case t.ACTION_EAST:g+A.x>T&&(A.x=T-g);break;case t.ACTION_WEST:d+A.x<E&&(A.x=E-d);break;case t.ACTION_NORTH:l+A.y<C&&(A.y=C-l);break;case t.ACTION_SOUTH:u+A.y>N&&(A.y=N-u)}};switch(h){case t.ACTION_ALL:d+=A.x,l+=A.y;break;case t.ACTION_EAST:if(A.x>=0&&(g>=T||c&&(l<=C||u>=N))){v=!1;break}_(t.ACTION_EAST),(p+=A.x)<0&&(h=t.ACTION_WEST,d-=p=-p),c&&(m=p/c,l+=(r.height-m)/2);break;case t.ACTION_NORTH:if(A.y<=0&&(l<=C||c&&(d<=E||g>=T))){v=!1;break}_(t.ACTION_NORTH),m-=A.y,l+=A.y,m<0&&(h=t.ACTION_SOUTH,l-=m=-m),c&&(p=m*c,d+=(r.width-p)/2);break;case t.ACTION_WEST:if(A.x<=0&&(d<=E||c&&(l<=C||u>=N))){v=!1;break}_(t.ACTION_WEST),p-=A.x,d+=A.x,p<0&&(h=t.ACTION_EAST,d-=p=-p),c&&(m=p/c,l+=(r.height-m)/2);break;case t.ACTION_SOUTH:if(A.y>=0&&(u>=N||c&&(d<=E||g>=T))){v=!1;break}_(t.ACTION_SOUTH),(m+=A.y)<0&&(h=t.ACTION_NORTH,l-=m=-m),c&&(p=m*c,d+=(r.width-p)/2);break;case t.ACTION_NORTH_EAST:if(c){if(A.y<=0&&(l<=C||g>=T)){v=!1;break}_(t.ACTION_NORTH),m-=A.y,l+=A.y,p=m*c}else _(t.ACTION_NORTH),_(t.ACTION_EAST),A.x>=0?g<T?p+=A.x:A.y<=0&&l<=C&&(v=!1):p+=A.x,A.y<=0?l>C&&(m-=A.y,l+=A.y):(m-=A.y,l+=A.y);p<0&&m<0?(h=t.ACTION_SOUTH_WEST,l-=m=-m,d-=p=-p):p<0?(h=t.ACTION_NORTH_WEST,d-=p=-p):m<0&&(h=t.ACTION_SOUTH_EAST,l-=m=-m);break;case t.ACTION_NORTH_WEST:if(c){if(A.y<=0&&(l<=C||d<=E)){v=!1;break}_(t.ACTION_NORTH),m-=A.y,l+=A.y,p=m*c,d+=r.width-p}else _(t.ACTION_NORTH),_(t.ACTION_WEST),A.x<=0?d>E?(p-=A.x,d+=A.x):A.y<=0&&l<=C&&(v=!1):(p-=A.x,d+=A.x),A.y<=0?l>C&&(m-=A.y,l+=A.y):(m-=A.y,l+=A.y);p<0&&m<0?(h=t.ACTION_SOUTH_EAST,l-=m=-m,d-=p=-p):p<0?(h=t.ACTION_NORTH_EAST,d-=p=-p):m<0&&(h=t.ACTION_SOUTH_WEST,l-=m=-m);break;case t.ACTION_SOUTH_WEST:if(c){if(A.x<=0&&(d<=E||u>=N)){v=!1;break}_(t.ACTION_WEST),p-=A.x,d+=A.x,m=p/c}else _(t.ACTION_SOUTH),_(t.ACTION_WEST),A.x<=0?d>E?(p-=A.x,d+=A.x):A.y>=0&&u>=N&&(v=!1):(p-=A.x,d+=A.x),A.y>=0?u<N&&(m+=A.y):m+=A.y;p<0&&m<0?(h=t.ACTION_NORTH_EAST,l-=m=-m,d-=p=-p):p<0?(h=t.ACTION_SOUTH_EAST,d-=p=-p):m<0&&(h=t.ACTION_NORTH_WEST,l-=m=-m);break;case t.ACTION_SOUTH_EAST:if(c){if(A.x>=0&&(g>=T||u>=N)){v=!1;break}_(t.ACTION_EAST),p+=A.x,m=p/c}else _(t.ACTION_SOUTH),_(t.ACTION_EAST),A.x>=0?g<T?p+=A.x:A.y>=0&&u>=N&&(v=!1):p+=A.x,A.y>=0?u<N&&(m+=A.y):m+=A.y;p<0&&m<0?(h=t.ACTION_NORTH_WEST,l-=m=-m,d-=p=-p):p<0?(h=t.ACTION_SOUTH_WEST,d-=p=-p):m<0&&(h=t.ACTION_NORTH_EAST,l-=m=-m);break;case t.ACTION_MOVE:this.move(A.x,A.y),v=!1;break;case t.ACTION_ZOOM:this.zoom(e.getMaxZoomRatio(o),i),v=!1;break;case t.ACTION_CROP:if(!A.x||!A.y){v=!1;break}f=e.getOffset(this.cropper),d=O.startX-f.left,l=O.startY-f.top,p=r.minWidth,m=r.minHeight,A.x>0?h=A.y>0?t.ACTION_SOUTH_EAST:t.ACTION_NORTH_EAST:A.x<0&&(d-=p,h=A.y>0?t.ACTION_SOUTH_WEST:t.ACTION_NORTH_WEST),A.y<0&&(l-=m),this.cropped||(e.removeClass(this.cropBox,t.CLASS_HIDDEN),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}v&&(r.width=p,r.height=m,r.left=d,r.top=l,this.action=h,this.renderCropBox()),e.forEach(o,t=>{t.startX=t.endX,t.startY=t.endY})}}}),t("skylark-cropperjs/methods",["./constants","./utilities"],function(t,e){"use strict";return{crop(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&e.addClass(this.dragBox,t.CLASS_MODAL),e.removeClass(this.cropBox,t.CLASS_HIDDEN),this.setCropBoxData(this.initialCropBoxData)),this},reset(){return this.ready&&!this.disabled&&(this.imageData=e.assign({},this.initialImageData),this.canvasData=e.assign({},this.initialCanvasData),this.cropBoxData=e.assign({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear(){return this.cropped&&!this.disabled&&(e.assign(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),e.removeClass(this.dragBox,t.CLASS_MODAL),e.addClass(this.cropBox,t.CLASS_HIDDEN)),this},replace(t,i=!1){return!this.disabled&&t&&(this.isImg&&(this.element.src=t),i?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,e.forEach(this.previews,e=>{e.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable(){return this.ready&&this.disabled&&(this.disabled=!1,e.removeClass(this.cropper,t.CLASS_DISABLED)),this},disable(){return this.ready&&!this.disabled&&(this.disabled=!0,e.addClass(this.cropper,t.CLASS_DISABLED)),this},destroy(){const{element:e}=this;return e[t.NAMESPACE]?(e[t.NAMESPACE]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move(t,i=t){const{left:a,top:s}=this.canvasData;return this.moveTo(e.isUndefined(t)?t:a+Number(t),e.isUndefined(i)?i:s+Number(i))},moveTo(t,i=t){const{canvasData:a}=this;let s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(e.isNumber(t)&&(a.left=t,s=!0),e.isNumber(i)&&(a.top=i,s=!0),s&&this.renderCanvas(!0)),this},zoom(t,e){const{canvasData:i}=this;return t=(t=Number(t))<0?1/(1-t):1+t,this.zoomTo(i.width*t/i.naturalWidth,null,e)},zoomTo(i,a,s){const{options:n,canvasData:r}=this,{width:o,height:h,naturalWidth:c,naturalHeight:d}=r;if((i=Number(i))>=0&&this.ready&&!this.disabled&&n.zoomable){const n=c*i,l=d*i;if(!1===e.dispatchEvent(this.element,t.EVENT_ZOOM,{ratio:i,oldRatio:o/c,originalEvent:s}))return this;if(s){const{pointers:t}=this,i=e.getOffset(this.cropper),a=t&&Object.keys(t).length?e.getPointersCenter(t):{pageX:s.pageX,pageY:s.pageY};r.left-=(n-o)*((a.pageX-i.left-r.left)/o),r.top-=(l-h)*((a.pageY-i.top-r.top)/h)}else e.isPlainObject(a)&&e.isNumber(a.x)&&e.isNumber(a.y)?(r.left-=(n-o)*((a.x-r.left)/o),r.top-=(l-h)*((a.y-r.top)/h)):(r.left-=(n-o)/2,r.top-=(l-h)/2);r.width=n,r.height=l,this.renderCanvas(!0)}return this},rotate(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo(t){return t=Number(t),e.isNumber(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX(t){const{scaleY:i}=this.imageData;return this.scale(t,e.isNumber(i)?i:1)},scaleY(t){const{scaleX:i}=this.imageData;return this.scale(e.isNumber(i)?i:1,t)},scale(t,i=t){const{imageData:a}=this;let s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(e.isNumber(t)&&(a.scaleX=t,s=!0),e.isNumber(i)&&(a.scaleY=i,s=!0),s&&this.renderCanvas(!0,!0)),this},getData(t=!1){const{options:i,imageData:a,canvasData:s,cropBoxData:n}=this;let r;if(this.ready&&this.cropped){r={x:n.left-s.left,y:n.top-s.top,width:n.width,height:n.height};const i=a.width/a.naturalWidth;if(e.forEach(r,(t,e)=>{r[e]=t/i}),t){const t=Math.round(r.y+r.height),e=Math.round(r.x+r.width);r.x=Math.round(r.x),r.y=Math.round(r.y),r.width=e-r.x,r.height=t-r.y}}else r={x:0,y:0,width:0,height:0};return i.rotatable&&(r.rotate=a.rotate||0),i.scalable&&(r.scaleX=a.scaleX||1,r.scaleY=a.scaleY||1),r},setData(t){const{options:i,imageData:a,canvasData:s}=this,n={};if(this.ready&&!this.disabled&&e.isPlainObject(t)){let r=!1;i.rotatable&&e.isNumber(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,r=!0),i.scalable&&(e.isNumber(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,r=!0),e.isNumber(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,r=!0)),r&&this.renderCanvas(!0,!0);const o=a.width/a.naturalWidth;e.isNumber(t.x)&&(n.left=t.x*o+s.left),e.isNumber(t.y)&&(n.top=t.y*o+s.top),e.isNumber(t.width)&&(n.width=t.width*o),e.isNumber(t.height)&&(n.height=t.height*o),this.setCropBoxData(n)}return this},getContainerData(){return this.ready?e.assign({},this.containerData):{}},getImageData(){return this.sized?e.assign({},this.imageData):{}},getCanvasData(){const{canvasData:t}=this,i={};return this.ready&&e.forEach(["left","top","width","height","naturalWidth","naturalHeight"],e=>{i[e]=t[e]}),i},setCanvasData(t){const{canvasData:i}=this,{aspectRatio:a}=i;return this.ready&&!this.disabled&&e.isPlainObject(t)&&(e.isNumber(t.left)&&(i.left=t.left),e.isNumber(t.top)&&(i.top=t.top),e.isNumber(t.width)?(i.width=t.width,i.height=t.width/a):e.isNumber(t.height)&&(i.height=t.height,i.width=t.height*a),this.renderCanvas(!0)),this},getCropBoxData(){const{cropBoxData:t}=this;let e;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData(t){const{cropBoxData:i}=this,{aspectRatio:a}=this.options;let s,n;return this.ready&&this.cropped&&!this.disabled&&e.isPlainObject(t)&&(e.isNumber(t.left)&&(i.left=t.left),e.isNumber(t.top)&&(i.top=t.top),e.isNumber(t.width)&&t.width!==i.width&&(s=!0,i.width=t.width),e.isNumber(t.height)&&t.height!==i.height&&(n=!0,i.height=t.height),a&&(s?i.height=i.width/a:n&&(i.width=i.height*a)),this.renderCropBox()),this},getCroppedCanvas(t={}){if(!this.ready||!window.HTMLCanvasElement)return null;const{canvasData:i}=this,a=e.getSourceCanvas(this.image,this.imageData,i,t);if(!this.cropped)return a;let{x:s,y:n,width:r,height:o}=this.getData();const h=a.width/Math.floor(i.naturalWidth);1!==h&&(s*=h,n*=h,r*=h,o*=h);const c=r/o,d=e.getAdjustedSizes({aspectRatio:c,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),l=e.getAdjustedSizes({aspectRatio:c,width:t.minWidth||0,height:t.minHeight||0},"cover");let{width:p,height:m}=e.getAdjustedSizes({aspectRatio:c,width:t.width||(1!==h?a.width:r),height:t.height||(1!==h?a.height:o)});p=Math.min(d.width,Math.max(l.width,p)),m=Math.min(d.height,Math.max(l.height,m));const g=document.createElement("canvas"),u=g.getContext("2d");g.width=e.normalizeDecimalNumber(p),g.height=e.normalizeDecimalNumber(m),u.fillStyle=t.fillColor||"transparent",u.fillRect(0,0,p,m);const{imageSmoothingEnabled:f=!0,imageSmoothingQuality:E}=t;u.imageSmoothingEnabled=f,E&&(u.imageSmoothingQuality=E);const C=a.width,T=a.height;let N,v,O,A,_,w,b=s,x=n;b<=-r||b>C?(b=0,N=0,O=0,_=0):b<=0?(O=-b,b=0,N=Math.min(C,r+b),_=N):b<=C&&(O=0,N=Math.min(r,C-b),_=N),N<=0||x<=-o||x>T?(x=0,v=0,A=0,w=0):x<=0?(A=-x,x=0,v=Math.min(T,o+x),w=v):x<=T&&(A=0,v=Math.min(o,T-x),w=v);const D=[b,x,N,v];if(_>0&&w>0){const t=p/r;D.push(O*t,A*t,_*t,w*t)}return u.drawImage(a,...D.map(t=>Math.floor(e.normalizeDecimalNumber(t)))),g},setAspectRatio(t){const{options:i}=this;return this.disabled||e.isUndefined(t)||(i.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode(i){const{options:a,dragBox:s,face:n}=this;if(this.ready&&!this.disabled){const r=i===t.DRAG_MODE_CROP,o=a.movable&&i===t.DRAG_MODE_MOVE;i=r||o?i:t.DRAG_MODE_NONE,a.dragMode=i,e.setData(s,t.DATA_ACTION,i),e.toggleClass(s,t.CLASS_CROP,r),e.toggleClass(s,t.CLASS_MOVE,o),a.cropBoxMovable||(e.setData(n,t.DATA_ACTION,i),e.toggleClass(n,t.CLASS_CROP,r),e.toggleClass(n,t.CLASS_MOVE,o))}return this}}}),t("skylark-cropperjs/Cropper",["skylark-langx/skylark","./defaults","./template","./render","./preview","./events","./handlers","./change","./methods","./constants","./utilities"],function(t,e,i,a,s,n,r,o,h,c,d){"use strict";const l=c.WINDOW.Cropper;class p{constructor(t,i={}){if(!t||!c.REGEXP_TAG_NAME.test(t.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=t,this.options=d.assign({},e,d.isPlainObject(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}init(){const{element:t}=this,e=t.tagName.toLowerCase();let i;if(!t[c.NAMESPACE]){if(t[c.NAMESPACE]=this,"img"===e){if(this.isImg=!0,i=t.getAttribute("src")||"",this.originalUrl=i,!i)return;i=t.src}else"canvas"===e&&window.HTMLCanvasElement&&(i=t.toDataURL());this.load(i)}}load(t){if(!t)return;this.url=t,this.imageData={};const{element:e,options:i}=this;if(i.rotatable||i.scalable||(i.checkOrientation=!1),!i.checkOrientation||!window.ArrayBuffer)return void this.clone();if(c.REGEXP_DATA_URL.test(t))return void(c.REGEXP_DATA_URL_JPEG.test(t)?this.read(d.dataURLToArrayBuffer(t)):this.clone());const a=new XMLHttpRequest,s=this.clone.bind(this);this.reloading=!0,this.xhr=a,a.onabort=s,a.onerror=s,a.ontimeout=s,a.onprogress=(()=>{a.getResponseHeader("content-type")!==c.MIME_TYPE_JPEG&&a.abort()}),a.onload=(()=>{this.read(a.response)}),a.onloadend=(()=>{this.reloading=!1,this.xhr=null}),i.checkCrossOrigin&&d.isCrossOriginURL(t)&&e.crossOrigin&&(t=d.addTimestamp(t)),a.open("GET",t),a.responseType="arraybuffer",a.withCredentials="use-credentials"===e.crossOrigin,a.send()}read(t){const{options:e,imageData:i}=this,a=d.resetAndGetOrientation(t);let s=0,n=1,r=1;a>1&&(this.url=d.arrayBufferToDataURL(t,c.MIME_TYPE_JPEG),({rotate:s,scaleX:n,scaleY:r}=d.parseOrientation(a))),e.rotatable&&(i.rotate=s),e.scalable&&(i.scaleX=n,i.scaleY=r),this.clone()}clone(){const{element:t,url:e}=this;let{crossOrigin:i}=t,a=e;this.options.checkCrossOrigin&&d.isCrossOriginURL(e)&&(i||(i="anonymous"),a=d.addTimestamp(e)),this.crossOrigin=i,this.crossOriginUrl=a;const s=document.createElement("img");i&&(s.crossOrigin=i),s.src=a||e,s.alt=t.alt||"The image to crop",this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),d.addClass(s,c.CLASS_HIDE),t.parentNode.insertBefore(s,t.nextSibling)}start(){const{image:t}=this;t.onload=null,t.onerror=null,this.sizing=!0;const e=c.WINDOW.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(c.WINDOW.navigator.userAgent),i=(t,e)=>{d.assign(this.imageData,{naturalWidth:t,naturalHeight:e,aspectRatio:t/e}),this.sizing=!1,this.sized=!0,this.build()};if(t.naturalWidth&&!e)return void i(t.naturalWidth,t.naturalHeight);const a=document.createElement("img"),s=document.body||document.documentElement;this.sizingImage=a,a.onload=(()=>{i(a.width,a.height),e||s.removeChild(a)}),a.src=t.src,e||(a.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",s.appendChild(a))}stop(){const{image:t}=this;t.onload=null,t.onerror=null,t.parentNode.removeChild(t),this.image=null}build(){if(!this.sized||this.ready)return;const{element:t,options:e,image:a}=this,s=t.parentNode,n=document.createElement("div");n.innerHTML=i;const r=n.querySelector(`.${c.NAMESPACE}-container`),o=r.querySelector(`.${c.NAMESPACE}-canvas`),h=r.querySelector(`.${c.NAMESPACE}-drag-box`),l=r.querySelector(`.${c.NAMESPACE}-crop-box`),p=l.querySelector(`.${c.NAMESPACE}-face`);this.container=s,this.cropper=r,this.canvas=o,this.dragBox=h,this.cropBox=l,this.viewBox=r.querySelector(`.${c.NAMESPACE}-view-box`),this.face=p,o.appendChild(a),d.addClass(t,c.CLASS_HIDDEN),s.insertBefore(r,t.nextSibling),this.isImg||d.removeClass(a,c.CLASS_HIDE),this.initPreview(),this.bind(),e.initialAspectRatio=Math.max(0,e.initialAspectRatio)||NaN,e.aspectRatio=Math.max(0,e.aspectRatio)||NaN,e.viewMode=Math.max(0,Math.min(3,Math.round(e.viewMode)))||0,d.addClass(l,c.CLASS_HIDDEN),e.guides||d.addClass(l.getElementsByClassName(`${c.NAMESPACE}-dashed`),c.CLASS_HIDDEN),e.center||d.addClass(l.getElementsByClassName(`${c.NAMESPACE}-center`),c.CLASS_HIDDEN),e.background&&d.addClass(r,`${c.NAMESPACE}-bg`),e.highlight||d.addClass(p,c.CLASS_INVISIBLE),e.cropBoxMovable&&(d.addClass(p,c.CLASS_MOVE),d.setData(p,c.DATA_ACTION,c.ACTION_ALL)),e.cropBoxResizable||(d.addClass(l.getElementsByClassName(`${c.NAMESPACE}-line`),c.CLASS_HIDDEN),d.addClass(l.getElementsByClassName(`${c.NAMESPACE}-point`),c.CLASS_HIDDEN)),this.render(),this.ready=!0,this.setDragMode(e.dragMode),e.autoCrop&&this.crop(),this.undefined(e.data),d.isFunction(e.ready)&&d.addListener(t,c.EVENT_READY,e.ready,{once:!0}),d.dispatchEvent(t,c.EVENT_READY)}unbuild(){this.ready&&(this.ready=!1,this.unbind(),this.resetPreview(),this.cropper.parentNode.removeChild(this.cropper),d.removeClass(this.element,c.CLASS_HIDDEN))}uncreate(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}static noConflict(){return window.Cropper=l,p}static setDefaults(t){d.assign(e,d.isPlainObject(t)&&t)}}return d.assign(p.prototype,a,s,n,r,o,h),t.attach("intg.Cropper",p)}),t("skylark-cropperjs/main",["./Cropper"],function(t){return t}),t("skylark-cropperjs",["skylark-cropperjs/main"],function(t){return t})}(i),!a){var r=require("skylark-langx/skylark");s?module.exports=r:e.skylarkjs=r}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-cropperjs-all.js.map
