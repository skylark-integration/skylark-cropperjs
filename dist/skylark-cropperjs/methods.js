/**
 * skylark-cropperjs - A version of cropperjs that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-cropperjs/
 * @license MIT
 */
define(["./constants","./utilities"],function(t,e){"use strict";return{crop(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&e.addClass(this.dragBox,t.CLASS_MODAL),e.removeClass(this.cropBox,t.CLASS_HIDDEN),this.setCropBoxData(this.initialCropBoxData)),this},reset(){return this.ready&&!this.disabled&&(this.imageData=e.assign({},this.initialImageData),this.canvasData=e.assign({},this.initialCanvasData),this.cropBoxData=e.assign({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear(){return this.cropped&&!this.disabled&&(e.assign(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),e.removeClass(this.dragBox,t.CLASS_MODAL),e.addClass(this.cropBox,t.CLASS_HIDDEN)),this},replace(t,i=!1){return!this.disabled&&t&&(this.isImg&&(this.element.src=t),i?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,e.forEach(this.previews,e=>{e.getElementsByTagName("img")[0].src=t}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable(){return this.ready&&this.disabled&&(this.disabled=!1,e.removeClass(this.cropper,t.CLASS_DISABLED)),this},disable(){return this.ready&&!this.disabled&&(this.disabled=!0,e.addClass(this.cropper,t.CLASS_DISABLED)),this},destroy(){const{element:e}=this;return e[t.NAMESPACE]?(e[t.NAMESPACE]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move(t,i=t){const{left:a,top:s}=this.canvasData;return this.moveTo(e.isUndefined(t)?t:a+Number(t),e.isUndefined(i)?i:s+Number(i))},moveTo(t,i=t){const{canvasData:a}=this;let s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.movable&&(e.isNumber(t)&&(a.left=t,s=!0),e.isNumber(i)&&(a.top=i,s=!0),s&&this.renderCanvas(!0)),this},zoom(t,e){const{canvasData:i}=this;return t=(t=Number(t))<0?1/(1-t):1+t,this.zoomTo(i.width*t/i.naturalWidth,null,e)},zoomTo(i,a,s){const{options:h,canvasData:r}=this,{width:o,height:n,naturalWidth:d,naturalHeight:l}=r;if((i=Number(i))>=0&&this.ready&&!this.disabled&&h.zoomable){const h=d*i,c=l*i;if(!1===e.dispatchEvent(this.element,t.EVENT_ZOOM,{ratio:i,oldRatio:o/d,originalEvent:s}))return this;if(s){const{pointers:t}=this,i=e.getOffset(this.cropper),a=t&&Object.keys(t).length?e.getPointersCenter(t):{pageX:s.pageX,pageY:s.pageY};r.left-=(h-o)*((a.pageX-i.left-r.left)/o),r.top-=(c-n)*((a.pageY-i.top-r.top)/n)}else e.isPlainObject(a)&&e.isNumber(a.x)&&e.isNumber(a.y)?(r.left-=(h-o)*((a.x-r.left)/o),r.top-=(c-n)*((a.y-r.top)/n)):(r.left-=(h-o)/2,r.top-=(c-n)/2);r.width=h,r.height=c,this.renderCanvas(!0)}return this},rotate(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo(t){return t=Number(t),e.isNumber(t)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX(t){const{scaleY:i}=this.imageData;return this.scale(t,e.isNumber(i)?i:1)},scaleY(t){const{scaleX:i}=this.imageData;return this.scale(e.isNumber(i)?i:1,t)},scale(t,i=t){const{imageData:a}=this;let s=!1;return t=Number(t),i=Number(i),this.ready&&!this.disabled&&this.options.scalable&&(e.isNumber(t)&&(a.scaleX=t,s=!0),e.isNumber(i)&&(a.scaleY=i,s=!0),s&&this.renderCanvas(!0,!0)),this},getData(t=!1){const{options:i,imageData:a,canvasData:s,cropBoxData:h}=this;let r;if(this.ready&&this.cropped){r={x:h.left-s.left,y:h.top-s.top,width:h.width,height:h.height};const i=a.width/a.naturalWidth;if(e.forEach(r,(t,e)=>{r[e]=t/i}),t){const t=Math.round(r.y+r.height),e=Math.round(r.x+r.width);r.x=Math.round(r.x),r.y=Math.round(r.y),r.width=e-r.x,r.height=t-r.y}}else r={x:0,y:0,width:0,height:0};return i.rotatable&&(r.rotate=a.rotate||0),i.scalable&&(r.scaleX=a.scaleX||1,r.scaleY=a.scaleY||1),r},setData(t){const{options:i,imageData:a,canvasData:s}=this,h={};if(this.ready&&!this.disabled&&e.isPlainObject(t)){let r=!1;i.rotatable&&e.isNumber(t.rotate)&&t.rotate!==a.rotate&&(a.rotate=t.rotate,r=!0),i.scalable&&(e.isNumber(t.scaleX)&&t.scaleX!==a.scaleX&&(a.scaleX=t.scaleX,r=!0),e.isNumber(t.scaleY)&&t.scaleY!==a.scaleY&&(a.scaleY=t.scaleY,r=!0)),r&&this.renderCanvas(!0,!0);const o=a.width/a.naturalWidth;e.isNumber(t.x)&&(h.left=t.x*o+s.left),e.isNumber(t.y)&&(h.top=t.y*o+s.top),e.isNumber(t.width)&&(h.width=t.width*o),e.isNumber(t.height)&&(h.height=t.height*o),this.setCropBoxData(h)}return this},getContainerData(){return this.ready?e.assign({},this.containerData):{}},getImageData(){return this.sized?e.assign({},this.imageData):{}},getCanvasData(){const{canvasData:t}=this,i={};return this.ready&&e.forEach(["left","top","width","height","naturalWidth","naturalHeight"],e=>{i[e]=t[e]}),i},setCanvasData(t){const{canvasData:i}=this,{aspectRatio:a}=i;return this.ready&&!this.disabled&&e.isPlainObject(t)&&(e.isNumber(t.left)&&(i.left=t.left),e.isNumber(t.top)&&(i.top=t.top),e.isNumber(t.width)?(i.width=t.width,i.height=t.width/a):e.isNumber(t.height)&&(i.height=t.height,i.width=t.height*a),this.renderCanvas(!0)),this},getCropBoxData(){const{cropBoxData:t}=this;let e;return this.ready&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData(t){const{cropBoxData:i}=this,{aspectRatio:a}=this.options;let s,h;return this.ready&&this.cropped&&!this.disabled&&e.isPlainObject(t)&&(e.isNumber(t.left)&&(i.left=t.left),e.isNumber(t.top)&&(i.top=t.top),e.isNumber(t.width)&&t.width!==i.width&&(s=!0,i.width=t.width),e.isNumber(t.height)&&t.height!==i.height&&(h=!0,i.height=t.height),a&&(s?i.height=i.width/a:h&&(i.width=i.height*a)),this.renderCropBox()),this},getCroppedCanvas(t={}){if(!this.ready||!window.HTMLCanvasElement)return null;const{canvasData:i}=this,a=e.getSourceCanvas(this.image,this.imageData,i,t);if(!this.cropped)return a;let{x:s,y:h,width:r,height:o}=this.getData();const n=a.width/Math.floor(i.naturalWidth);1!==n&&(s*=n,h*=n,r*=n,o*=n);const d=r/o,l=e.getAdjustedSizes({aspectRatio:d,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),c=e.getAdjustedSizes({aspectRatio:d,width:t.minWidth||0,height:t.minHeight||0},"cover");let{width:g,height:m}=e.getAdjustedSizes({aspectRatio:d,width:t.width||(1!==n?a.width:r),height:t.height||(1!==n?a.height:o)});g=Math.min(l.width,Math.max(c.width,g)),m=Math.min(l.height,Math.max(c.height,m));const p=document.createElement("canvas"),u=p.getContext("2d");p.width=e.normalizeDecimalNumber(g),p.height=e.normalizeDecimalNumber(m),u.fillStyle=t.fillColor||"transparent",u.fillRect(0,0,g,m);const{imageSmoothingEnabled:b=!0,imageSmoothingQuality:D}=t;u.imageSmoothingEnabled=b,D&&(u.imageSmoothingQuality=D);const C=a.width,N=a.height;let f,w,v,x,y,S,A=s,M=h;A<=-r||A>C?(A=0,f=0,v=0,y=0):A<=0?(v=-A,A=0,y=f=Math.min(C,r+A)):A<=C&&(v=0,y=f=Math.min(r,C-A)),f<=0||M<=-o||M>N?(M=0,w=0,x=0,S=0):M<=0?(x=-M,M=0,S=w=Math.min(N,o+M)):M<=N&&(x=0,S=w=Math.min(o,N-M));const B=[A,M,f,w];if(y>0&&S>0){const t=g/r;B.push(v*t,x*t,y*t,S*t)}return u.drawImage(a,...B.map(t=>Math.floor(e.normalizeDecimalNumber(t)))),p},setAspectRatio(t){const{options:i}=this;return this.disabled||e.isUndefined(t)||(i.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode(i){const{options:a,dragBox:s,face:h}=this;if(this.ready&&!this.disabled){const r=i===t.DRAG_MODE_CROP,o=a.movable&&i===t.DRAG_MODE_MOVE;i=r||o?i:t.DRAG_MODE_NONE,a.dragMode=i,e.setData(s,t.DATA_ACTION,i),e.toggleClass(s,t.CLASS_CROP,r),e.toggleClass(s,t.CLASS_MOVE,o),a.cropBoxMovable||(e.setData(h,t.DATA_ACTION,i),e.toggleClass(h,t.CLASS_CROP,r),e.toggleClass(h,t.CLASS_MOVE,o))}return this}}});
//# sourceMappingURL=sourcemaps/methods.js.map
